<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        #playerPanel {
            flex: 1;
            padding: 10px;
            background-color: #f0f0f0;
        }

        #map {
            flex: 2;
            height: 50%;
        }
    </style>
    <title>Train Game</title>
</head>
<body>

<div id="playerPanel">
    <!-- Zde můžete umístit obsah hráčova panelu, např. portfolio, kupony vlaků, atd. -->
    <h2>Player Panel</h2>
    <p id="finance">Finance: 1000 Kč</p>
    <p>Kupony vlaků: 1</p>
    <p>Vlaky v provozu: 2</p>
    <!-- Doplnit další informace podle potřeby -->
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    // Fiktivní data pro linky a zastávky
    const lines = [
        {
            name: "Trať 198 Strakonice - Volary",
            color: "blue",
            stops: [
                { name: "Strakonice", location: [49.2551575, 13.9163047] },
                { name: "Radošovice", location: [49.2322158, 13.901812] },
                { name: "Přední Zborovice", location: [49.2183647, 13.8940200] },
                { name: "Strunkovice nad Volyňkou", location: [49.2100447, 13.8872928] },
                { name: "Hoštice", location: [49.1873397, 13.8930731] },
                { name: "Volyně", location: [49.1701164, 13.8928975] },
                { name: "Nišovice", location: [49.1502839, 13.9059867] },
                { name: "Malenice", location: [49.1237908, 13.8832197] },
                { name: "Lčovice", location: [49.1090089, 13.8666047] },
                { name: "Čkyně", location: [49.1111489, 13.8291083] },
                { name: "Bohumilice v Čechách, zastávka", location: [49.0975800, 13.8137817] },
                { name: "Bohumilice v Čechách", location: [49.0927086, 13.8010150] },
                { name: "Vimperk", location: [49.0555267, 13.7907544] },
                { name: "Vimperk, zastávka", location: [49.0487633, 13.7639522] },
                { name: "Lipka", location: [49.0202103, 13.7354764] },
                { name: "Kubova Huť", location: [48.9830017, 13.7747478] },
                { name: "Horní Vltavice", location: [48.9625625, 13.7746514] },
                { name: "Zátoň", location: [48.9509200, 13.8030072] },
                { name: "Zátoň - Boubín", location: [48.9515725, 13.8224831] },
                { name: "Lenora", location: [48.9283675, 13.7969542] },
                { name: "Lenora zastávka", location: [48.9233969, 13.8026581] },
                { name: "Soumarský Most", location: [48.9080047, 13.8287611] },
                { name: "Volary", location: [48.9070969, 13.8833131] },
            ]
        },
        // Další linky můžete přidávat podle potřeby
    ];

    // Inicializace mapy Leaflet
    const map = L.map('map').setView([49.25, 13.91], 11);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // Přidání link a jejich zastávek na mapu
    lines.forEach(line => {
        // Linka
        let polyline = L.polyline(line.stops.map(stop => stop.location), { color: line.color }).addTo(map);
        polyline.bindPopup(line.name);

        // Zastávky
        line.stops.forEach(stop => {
            L.marker(stop.location).addTo(map).bindPopup(stop.name);
        });
    });

    // Pohybující se ikona vlaku
    let trainIcon = L.icon({
        iconUrl: 'https://i.imgur.com/jXoYbZs.png',
        iconSize: [100, 100],
        iconAnchor: [50, 50],
        popupAnchor: [0, 0]
    });

    // Vytvoření markerů pro každý vlak na počátečních pozicích
let trainMarkers = [
    L.marker(lines[0].stops[0].location, { icon: trainIcons[0] }).addTo(map),
    L.marker(lines[0].stops[lines[0].stops.length - 1].location, { icon: trainIcons[1] }).addTo(map),
    L.marker(lines[0].stops.find(stop => stop.name === "Čkyně").location, { icon: trainIcons[2] }).addTo(map),
    L.marker(lines[0].stops.find(stop => stop.name === "Vimperk").location, { icon: trainIcons[3] }).addTo(map),
];

// Počáteční indexy a směry pro každý vlak
let trainIndices = [0, lines[0].stops.length - 1, lines[0].stops.findIndex(stop => stop.name === "Čkyně"), lines[0].stops.findIndex(stop => stop.name === "Vimperk")];
let trainDirections = [1, -1, 1, -1];

// Nastavení intervalu pro aktualizaci polohy vlaků
setInterval(updateTrainPositions, 1000); // Každou sekundu aktualizuj polohy všech vlaků

// Funkce pro aktualizaci polohy všech vlaků
function updateTrainPositions() {
    for (let i = 0; i < trainMarkers.length; i++) {
        updateTrainPosition(trainMarkers[i], trainIndices[i], trainDirections[i]);
    }
}
    // Vypočítá vzdálenost mezi dvěma zastávkami
    function getDistance(lat1, lon1, lat2, lon2) {
        const R = 6371; // poloměr Země v km
        const dLat = toRadians(lat2 - lat1);
        const dLon = toRadians(lon2 - lon1);
        const a =
            Math.sin(dLat / 2) * Math.sin(dLat / 2) +
            Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) *
            Math.sin(dLon / 2) * Math.sin(dLon / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        const distance = R * c; // vzdálenost v km
        return distance;
    }

    // Převádí stupně na radiány
    function toRadians(degrees) {
        return degrees * Math.PI / 180;
    }

    // Funkce pro generování náhodné částky mezi 20 a 50 Kč
    function generateRandomAmount() {
        return Math.floor(Math.random() * (50 - 20 + 1)) + 20;
    }

     function updateTrainPosition(trainMarker, currentIndex, direction) {
    const currentLine = lines[0];
    const currentStop = currentLine.stops[currentIndex];
    const nextStop = currentLine.stops[currentIndex + direction];

    if (nextStop) {
        const distanceToNextStop = getDistance(currentStop.location[0], currentStop.location[1], nextStop.location[0], nextStop.location[1]);
        const timeToNextStop = distanceToNextStop / trainSpeed; // v hodinách

        const currentTime = new Date();
        const elapsedTime = (currentTime - startTime) / 1000 / 60 / 60; // v hodinách

        if (elapsedTime <= timeToNextStop) {
            const lat = currentStop.location[0] + (nextStop.location[0] - currentStop.location[0]) * (elapsedTime / timeToNextStop);
            const lon = currentStop.location[1] + (nextStop.location[1] - currentStop.location[1]) * (elapsedTime / timeToNextStop);
            trainMarker.setLatLng([lat, lon]);
        } else {
            // Přesun na další/zpětnou zastávku
            currentIndex += direction;
            startTime = new Date();

            // Pokud jsme dosáhli konce nebo začátku trasy, změníme směr pohybu
            if (currentIndex === 0 || currentIndex === currentLine.stops.length - 1) {
                direction *= -1;
            }
       

                // Přidáme náhodnou finanční částku do hráčova portfolia
                const randomAmount = generateRandomAmount();
                playerFinance += randomAmount;
                document.getElementById('finance').innerText = `Portfolio: ${playerFinance} Kč`;
            }
        }
    }

    // Nastavení intervalu pro aktualizaci polohy vlaku
    let startTime = new Date();
    let direction = 1; // Směr pohybu vlaku (1 = dopředu, -1 = zpět)
    let playerFinance = 1000; // Počáteční hodnota hráčova portfolia
    setInterval(updateTrainPosition, 1000); // Každou sekundu aktualizuj polohu vlaku
</script>

</body>
</html>

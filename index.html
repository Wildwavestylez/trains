<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Train Exchange</title>
    <style>
        #trainMarket {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        .train {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }
    </style>
</head>
<body>

    <h1>Train Exchange</h1>
    <div id="trainMarket"></div>
    <div>
        <h2>Your Portfolio</h2>
        <ul id="portfolio"></ul>
        <p>Total Money: $<span id="totalMoney">10000</span></p>
    </div>

    <script>
        const trainMarketElement = document.getElementById('trainMarket');
        const portfolioElement = document.getElementById('portfolio');
        const totalMoneyElement = document.getElementById('totalMoney');

        let money = 10000;
        let portfolio = [];

        const trains = [
            { id: 622, image: 'https://i.imgur.com/9gI6buP.png', description: 'Train 622' },
            { id: 61, image: 'https://i.imgur.com/ELbeAkI.png', description: 'Train 61' },
            { id: 1038, image: 'https://i.imgur.com/Ll9Fa7s.png', description: 'Train 1038' },
            { id: 1795, image: 'https://i.imgur.com/IPL5P9P.png', description: 'Train 1795' },
            { id: 'southern_express', image: 'https://i.imgur.com/XbzFNiC.png', description: 'Southern Express' },
            { id: 1, image: 'https://i.imgur.com/FHJVLeg.png', description: 'SNCF B 83500' },
            { id: 2, image: 'https://i.imgur.com/U3EmWzR.png', description: 'SNCF B 82500 (BiBi) TER Poitou Charentes' },
            { id: 3, image: 'https://i.imgur.com/vWdHlcn.png', description: 'FS E424.200 XMPR' },
            { id: 4, image: 'https://imgur.com/IPL5P9P', description: 'DB reihe 101 ' },

        ];

        function generateRandomTrain() {
            const randomTrain = trains[Math.floor(Math.random() * trains.length)];
            const train = {
                id: randomTrain.id,
                image: randomTrain.image,
                description: randomTrain.description,
                price: Math.floor(Math.random() * 5000) + 1000,
            };
            return train;
        }

        function generateRandomOffer() {
            const buyerCompany = getRandomEuropeanTransportCompany();
            const trainIndex = Math.floor(Math.random() * portfolio.length);
            const train = portfolio[trainIndex];
            const offerPrice = Math.floor(train.price * (Math.random() * 0.1 + 1.05)); // Nabídka za alespoň 105% původní ceny
            return { buyerCompany, train, offerPrice };
        }

        function getRandomEuropeanTransportCompany() {
            const europeanCompanies = ['EuroRail', 'TransEuropa', 'RailLink Europe', 'ExpressConnect'];
            return europeanCompanies[Math.floor(Math.random() * europeanCompanies.length)];
        }

        function displayTrains() {
            trainMarketElement.innerHTML = '';
            for (let i = 0; i < 3; i++) {
                const train = generateRandomTrain();
                const trainElement = document.createElement('div');
                trainElement.classList.add('train');
                trainElement.innerHTML = `
                    <img src="${train.image}" alt="${train.description}">
                    <p>${train.description}</p>
                    <p>Price: $${train.price}</p>
                    <button onclick="buyTrain(${i})">Buy</button>
                `;
                trainMarketElement.appendChild(trainElement);
            }
        }

        function buyTrain(index) {
            const train = generateRandomTrain();
            if (money >= train.price) {
                money -= train.price;
                portfolio.push(train);
                displayPortfolio();
                displayTrains();
                updateTotalMoney();
            } else {
                alert('Not enough money to buy this train!');
            }
        }

        function displayPortfolio() {
            portfolioElement.innerHTML = '';
            portfolio.forEach((train, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <img src="${train.image}" alt="${train.description}">
                    <p>${train.description}</p>
                    <p>Price: $${train.price}</p>
                `;
                portfolioElement.appendChild(li);
            });
        }

        function updateTotalMoney() {
            totalMoneyElement.textContent = money;
        }

        function displayOfferPopup(offer) {
            const sell = confirm(`The company ${offer.buyerCompany} wants to buy your train (${offer.train.description}) for $${offer.offerPrice}. Do you want to sell this train?`);
            if (sell) {
                const trainIndex = portfolio.findIndex(t => t.id === offer.train.id);
                if (trainIndex !== -1) {
                    money += offer.offerPrice;
                    portfolio.splice(trainIndex, 1);
                    displayPortfolio();
                    updateTotalMoney();
                }
            }
        }

        // Spustit hru
        displayTrains();
        displayPortfolio();
        updateTotalMoney();

        // Každou minutu zkontrolovat nabídku na odprodej
        setInterval(() => {
            const offer = generateRandomOffer();
            displayOfferPopup(offer);
        }, 60000);

        // Každých 20 vteřin obnovit nabídky na trhu
        setInterval(() => {
            displayTrains();
        }, 20000);
    </script>

</body>
</html>
